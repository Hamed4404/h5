<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <!-- BinScope properties and targets -->
    <PropertyGroup>
        <BinScopeOutDir Condition="'$(BinScopeOutDir)' == ''">$(ArtifactsPath)BinScope\</BinScopeOutDir>
        <BinScopeTargetDir Condition="'$(BinScopeTarget)' == ''">$(IntermediateOutputPath)BinScope\</BinScopeTargetDir>
        <BinScopeLogFile Condition="'$(BinScopeLogFile)' == ''">$(BinScopeOutDir)BinScopeResults.xml</BinScopeLogFile>

        <BinScope70InstallDir>$(MSBuildProgramFiles32)\Microsoft\BinScope for SDL 7.0\</BinScope70InstallDir>

        <BinScopeInstallDir Condition="('$(BinScopeInstallerDir)' == '') And (Exists('$(BinScope70InstallDir)'))">$(BinScope70InstallDir)</BinScopeInstallDir>
        <BinScopeEXE Condition="'$(BinScopeEXE)' == ''">$(BinScopeInstallDir)BinScope.EXE</BinScopeEXE>

        <BinScopeSymbolOption Condition="'$(BinScopeSymPath)' != ''">/sympath $(BinScopeSymPath)</BinScopeSymbolOption>
    </PropertyGroup>

    <Target Name="_BinScope" DependsOnTargets="BeforeBinScope">
        <RemoveDir Directories="$(BinScopeTargetDir)" />
        <MakeDir Directories="$(BinScopeTargetDir)" />

        <Copy SourceFiles="@(BinScopeTargetFiles)" DestinationFiles="@(BinScopeTargetFiles->'$(BinScopeTargetDir)%(RecursiveDir)\%(Filename)%(Extension)')" />

        <WriteLinesToFile File="$(IntermediateOutputPath)BinScope.rsp" Overwrite="true"
                          Lines="@(BinScopeTargetFiles->'/target $(BinScopeTargetDir)%(RecursiveDir)%(Filename)%(Extension) $(BinScopeSymbolOption)')" />

        <Exec Command="&quot;$(BinScopeEXE)&quot; @$(IntermediateOutputPath)BinScope.rsp /logfile $(BinScopeLogFile) /Xslt" />
    </Target>

    <Target Name="BinScope">
        <CallTarget Targets="_BinScope" />
    </Target>
</Project>