trigger:
- master
- release/*

# See https://github.com/aspnet/BuildTools
resources:
  repositories:
  - repository: buildtools
    type: github
    endpoint: DotNet-Bot GitHub Connection
    name: aspnet/BuildTools
    ref: refs/heads/release/2.1

jobs:
- template: ./project-ci.yml
  parameters:
    buildArgs: "/t:FastCheck"
- job: RepoBuilds
  pool:
    vmImage: vs2017-win2016
  strategy:
    maxParallel: 3
    matrix:
      DataProtection:
        _FolderName: DataProtection
      WebSockets:
        _FolderName: WebSockets
  steps:
  - script: src/$(_FolderName)/build.cmd -ci
    displayName: Run src/$(_FolderName)/build.cmd
  - task: PublishTestResults@2
    displayName: Publish test results
    condition: always()
    inputs:
      testRunner: vstest
      testResultsFiles: 'src/$(_FolderName)/artifacts/logs/**/*.trx'
- template: jobs/iisintegration_job.yml
  parameters:
    variables:
      _FolderName: IISIntegration
