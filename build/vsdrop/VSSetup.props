<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <PropertyGroup>
        <VSSetupProps>1</VSSetupProps>
        <!-- Location to where setup packages will be restored. -->
        <VSSetupPackagesRestorePath>$(WorkingDirectory)packages</VSSetupPackagesRestorePath>

        <SimplifiedWixCompilerTasksPath>$(VSSetupPackagesRestorePath)\Microsoft.Wix4.Tools\tools\bin\swc.exe</SimplifiedWixCompilerTasksPath>
        <SimplifiedWixTargets>$(VSSetupPackagesRestorePath)\MicroBuild.Plugins.SwixBuild\tools\SimplifiedWix.targets</SimplifiedWixTargets>
        <SwixBuildTargets>$(VSSetupPackagesRestorePath)\MicroBuild.Plugins.SwixBuild\build\MicroBuild.Plugins.SwixBuild.targets</SwixBuildTargets>
    </PropertyGroup>

    <PropertyGroup>
        <VSDropServiceUri>https://vsdrop.corp.microsoft.com/file/v1/</VSDropServiceUri>
        <DropServiceUri>https://devdiv.artifacts.visualstudio.com/</DropServiceUri>
        <DropExe>$(VSSetupPackagesRestorePath)\Drop.App\lib\net45\Drop.exe</DropExe>
        <!-- Default drop expiration date is 10 years from now -->
        <DropExpiration Condition="'$(DropExpiration)' == ''">10</DropExpiration>
        <DropExpirationDate>$([System.DateTime]::Now.AddYears($(DropExpiration)).ToString("M/d/yyyy h:m:s tt"))</DropExpirationDate>
        <!-- Timeout in minutes -->
        <DropTimeout>10</DropTimeout>
        <!-- Can be set to 'info', 'warn', 'error', 'verbose' -->
        <DropTraceLevel>verbose</DropTraceLevel>

        <!-- Commandline parameters for drop.exe -->
        <DropParamService>-s &quot;$(DropServiceUri)&quot;</DropParamService>
        <DropParamTimeout>--timeout &quot;$(DropTimeout)&quot;</DropParamTimeout>
        <DropParamTraceLevel>--tracelevel &quot;$(DropTraceLevel)&quot;</DropParamTraceLevel>
        <DropParamExpirationDate>-x &quot;$(DropExpirationDate)&quot;</DropParamExpirationDate>
        <!-- Use AAD for authentication -->
        <DropParamAuth>-a</DropParamAuth>
    </PropertyGroup>

    <PropertyGroup>
        <ManifestTeamProject>$(SYSTEM_TEAMPROJECT)</ManifestTeamProject>
        <ManifestTeamProject Condition="'$(ManifestTeamProject)' == ''">AspNet</ManifestTeamProject>
        <ManifestRepositoryName>$(BUILD_REPOSITORY_NAME)</ManifestRepositoryName>
        <ManifestRepositoryName Condition="'$(ManifestRepositoryName)' == ''">WPT</ManifestRepositoryName>
        <ManifestBuildBranch>$(BUILD_SOURCEBRANCHNAME)</ManifestBuildBranch>
        <ManifestBuildBranch Condition="'$(ManifestBuildBranch)' == ''">local_build</ManifestBuildBranch>
        <ManifestBuildNumber>$(BUILD_BUILDNUMBER)</ManifestBuildNumber>
        <ManifestBuildNumber Condition="'$(ManifestBuildNumber)' == ''">$([System.DateTime]::Now.ToString("yyMMddHHmmss")).1</ManifestBuildNumber>
    </PropertyGroup>

    <PropertyGroup>
        <ManifestPublishUrl>https://vsdrop.corp.microsoft.com/file/v1/Products/$(ManifestTeamProject)/$(ManifestRepositoryName)/$(ManifestBuildBranch)/$(ManifestBuildNumber);</ManifestPublishUrl>
        <VSManPublishUrl>$(ManifestPublishUrl)$(VSManOutputFileName)</VSManPublishUrl>
    </PropertyGroup>

    <PropertyGroup>
        <ManifestIntermediateOutputPath>$(WorkingDirectory)$(MSBuildProject)</ManifestIntermediateOutputPath>
    </PropertyGroup>
</Project>
