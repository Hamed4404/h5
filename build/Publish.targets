<Project>

  <!-- Inserts the Razor VSIX to the VS drop share -->
  <Target Name="RunVSDrop" DependsOnTargets="GetToolsets">
    <Error Text="MSBuild could not be located."
      Condition="'$(VisualStudioMSBuildx86Path)'==''" />

    <ItemGroup>
      <SignedRazorVSIX Include="$(SignedVSIXPath)*.vsix" />

      <MSBuildExeArgs Include="
        $(MSBuildThisFileDirectory)vsdrop\drop.msbuild;
        /t:BuildAndPublishManifest;
        /p:SignedVsixPath=$(SignedVSIXPath);
        /p:RepositoryRoot=$(RepositoryRoot);
        /p:ManifestRepositoryName=AspNetCore/%(SignedRazorVSIX.FileName);
        /p:ManifestBuildBranch=$(BUILD_BRANCH);
        /p:ManifestBuildNumber=$(BUILD_NUMBER)" />
    </ItemGroup>

    <Run FileName="$(VisualStudioMSBuildx86Path)" Arguments="@(MSBuildExeArgs)" Condition="Exists($(RazorVSIXFullPath))" />
  </Target>

  <Target Name="PushPackages">
    <ItemGroup>
      <PackagesToPush Include="$(CoherenceSignedDestinationDir)Packages\*.nupkg" />
      <PackagesToPush Include="$(CoherenceSignedDestinationDir)OobPackages\*.nupkg" />
      <PackagesToPush Include="$(CoherenceDestinationDir)ext\*.nupkg" />
      <PackagesToPush Include="$(CoherenceDestinationDir)noship\*.nupkg" />
    </ItemGroup>

    <PushNuGetPackages
      Packages="@(PackagesToPush)"
      Feed="$(PublishFeed)"
      ApiKey="$(APIKey)" />
  </Target>

</Project>
