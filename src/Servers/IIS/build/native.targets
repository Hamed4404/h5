<Project>

  <PropertyGroup>
    <IncludePath>$(IncludePath);$(IntDir)</IncludePath>
  </PropertyGroup>

  <ItemGroup Condition="@(MessageFile->Count()) != 0">
    <CustomBuild Include="@(MessageFile)">
      <FileType>Document</FileType>
      <Command>mc "%(FullPath)" -h $(IntDir) -r $(IntDir)</Command>
      <Message>Compiling Event Messages ...</Message>
      <Outputs>$(IntDir)\%(Filename).rc;$(IntDir)\%(Filename).h;$(IntDir)\MSG0409.bin</Outputs>
    </CustomBuild>

    <MessageFile Remove="@(MessageFile)" />
  </ItemGroup>

  <Target Name="CreateVersionHeader" DependsOnTargets="InitializeSourceControlInformation" BeforeTargets="PrepareForBuild">
    <PropertyGroup>
      <VersionHeaderContents><![CDATA[
// <auto-generated>

#define FileVersion $(AspNetCoreModuleVersionMajor),$(AspNetCoreMinorVersion),$(AssemblyBuild),$(AspNetCorePatchVersion)
#define FileVersionStr "$(AspNetCoreModuleVersionMajor).$(AspNetCoreMinorVersion).$(AssemblyBuild).$(AspNetCorePatchVersion)\0"
#define ProductVersion $(AspNetCoreModuleVersionMajor),$(AspNetCoreMinorVersion),$(AssemblyBuild),$(AspNetCorePatchVersion)
#define ProductVersionStr "$(AspNetCoreModuleVersionMajor).$(AspNetCoreMinorVersion).$(AssemblyBuild).$(AspNetCorePatchVersion)\0"
#define PlatformToolset "$(PlatformToolset)\0"
#define CommitHash "$(SourceRevisionId)\0"
      ]]></VersionHeaderContents>
    </PropertyGroup>

    <ItemGroup>
      <FileWrites Include="$(IntDir)version.h" />
    </ItemGroup>

    <WriteLinesToFile File="$(IntDir)version.h" Lines="$([MSBuild]::Escape($(VersionHeaderContents)))" OverWrite="true" WriteOnlyWhenDifferent="True" />
  </Target>

</Project>
