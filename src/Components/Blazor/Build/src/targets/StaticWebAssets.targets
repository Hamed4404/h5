<Project>

  <PropertyGroup>
    <ResolveStaticWebAssetsInputsDependsOn>
      $(ResolveStaticWebAssetsInputsDependsOn);
      _RemoveBlazorCurrentProjectAssetsFromStaticWebAssets;
    </ResolveStaticWebAssetsInputsDependsOn>
  </PropertyGroup>


  <Target Name="_RemoveBlazorCurrentProjectAssetsFromStaticWebAssets">
    <ItemGroup>
      <StaticWebAsset Remove="@(StaticWebAsset)" Condition="'%(SourceType)' == ''" />
    </ItemGroup>
  </Target>

  <Target Name="BlazorStaticWebAssetsComputeFilesToPublish"
    AfterTargets="_StaticWebAssetsComputeFilesToPublish">

    <ItemGroup>
      <_StandaloneExternalPublishStaticWebAsset Include="@(_ExternalPublishStaticWebAsset)" Condition="'%(RelativePath)' != ''">
        <RelativePath>$([MSBuild]::MakeRelative('$(MSBuildProjectDirectory)', '$([MSBuild]::NormalizePath('$([System.Text.RegularExpressions.Regex]::Replace('%(RelativePath)','^wwwroot\\?\/?(.*)','$(BlazorPublishDistDir)$1'))'))'))</RelativePath>
      </_StandaloneExternalPublishStaticWebAsset>

      <ResolvedFileToPublish Remove="@(_StandaloneExternalPublishStaticWebAsset)" />
      <ResolvedFileToPublish Include="@(_StandaloneExternalPublishStaticWebAsset)" />

    </ItemGroup>
  </Target>
</Project>
