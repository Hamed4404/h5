<Project>
  <PropertyGroup>
    <!-- Disable unwanted parts of the default publish process -->
    <CopyBuildOutputToPublishDirectory>false</CopyBuildOutputToPublishDirectory>
    <CopyOutputSymbolsToPublishDirectory>false</CopyOutputSymbolsToPublishDirectory>
    <PreserveCompilationContext>false</PreserveCompilationContext>
    <RazorCompileOnPublish>false</RazorCompileOnPublish>
    <GenerateDependencyFile>false</GenerateDependencyFile>
    <IsWebConfigTransformDisabled>true</IsWebConfigTransformDisabled>
  </PropertyGroup>

  <Target
    Name="_BlazorCleanupPublishOutput"
    AfterTargets="ComputeResolvedFilesToPublishList"
    Condition="'$(BlazorPrunePublishOutput)' != 'false'">

    <ItemGroup>
      <!-- Delete stray DLLs from the application. -->
      <ResolvedFileToPublish
        Remove="%(ResolvedFileToPublish.Identity)"
        Condition="$([System.String]::Copy('%(ResolvedFileToPublish.RelativePath)').EndsWith('dll'))"/>
      <!--Remove stray debugging files.-->
      <ResolvedFileToPublish
        Remove="%(ResolvedFileToPublish.Identity)"
        Condition="$([System.String]::Copy('%(ResolvedFileToPublish.RelativePath)').EndsWith('pdb'))"/>
      <!--Remove excluded static assets.-->
      <ResolvedFileToPublish
        Remove="%(ResolvedFileToPublish.Identity)"
        Condition="$([System.String]::Copy('%(ResolvedFileToPublish.RelativePath)').Replace('\','/').StartsWith('Excluded-Static-Web-Assets/'))"/>
    </ItemGroup>
  </Target>

  <!--After moving the resolved files to the publish directory, we can determine
  whether or not to copy the standalone config if the user has not provided
  their own.-->
  <Target
      Name="_BlazorCopyStandaloneWebConfig"
      AfterTargets="CopyFilesToPublishDirectory"
      Condition="!Exists('$(PublishDir)web.config')">
    <WriteLinesToFile
      File="$(PublishDir)web.config"
      Lines="$([System.IO.File]::ReadAllText('$(MSBuildThisFileDirectory)Standalone.Web.config'))" />
  </Target>

</Project>
